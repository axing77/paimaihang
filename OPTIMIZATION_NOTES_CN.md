# Auctionator 性能优化说明

## 问题描述
在泰坦时光服务器（中国版魔兽世界）上，使用Auctionator插件时出现严重卡顿：
- 搜索物品时反应慢
- 上架物品时响应迟钝
- 购买操作延迟严重

这很可能是官方为了限制"拍卖行地精"（使用插件频繁操作拍卖行获利的玩家）而对API实施了限流措施。

## 优化措施

### 1. 禁用全扫描功能（最重要）
**文件**: `Source_LegacyAH/FullScan/Mixins/Frame.lua`
**修改**: 在 `InitiateScan()` 函数开始处直接返回，避免调用 `QueryAuctionItems()` 进行全拍卖行扫描
**原因**: 全扫描会一次性请求所有拍卖行数据，这是最容易触发官方限流的操作

### 2. 减少批量处理速度
**文件**: `Source_LegacyAH/FullScan/Mixins/Frame.lua`
**修改**: 
- 批量大小从250降至50
- 批次间延迟从0.01秒增加到0.1秒
**原因**: 降低瞬时API调用频率

### 3. 减少限流超时时间
**文件**: `Source_LegacyAH/AH/Mixins/Throttling.lua`
**修改**: 超时时间从10秒减少到5秒
**原因**: 在保证不触发限制的前提下提升响应速度

### 4. 增加扫描页面间延迟
**文件**: `Source_LegacyAH/AH/Mixins/Scan.lua`
**修改**: 在查询下一页之前添加0.3秒延迟
**原因**: 减少连续查询频率，避免触发限流

### 5. 减少每页结果数量
**文件**: `Source_LegacyAH/Constants/Main.lua`
**修改**: MaxResultsPerPage从50减少到30
**原因**: 降低单次查询的数据量和服务器负载

### 6. 禁用默认的自动列表搜索
**文件**: `Source/Config/Main.lua`
**修改**: `AUTO_LIST_SEARCH` 默认值改为 false
**原因**: 减少不必要的自动查询

### 7. 确保全扫描选项默认禁用
**文件**: `Source/Config/Main.lua`
**修改**: 明确 `REPLICATE_SCAN` 设为 false
**原因**: 防止用户意外触发全扫描

### 8. 优化取消扫描速度
**文件**: `Source_LegacyAH/Tabs/Cancelling/Mixins/UndercutScan.lua`
**修改**: 
- 在NextStep函数中添加0.2秒延迟
- 在ProcessScanResult中添加0.3秒延迟
**原因**: 取消扫描需要为每个自己的拍卖物品查询价格，添加延迟避免连续快速查询

## 使用建议

1. **避免频繁搜索**: 尽量减少短时间内的重复搜索
2. **逐个处理**: 不要连续快速上架或购买大量物品
3. **耐心等待**: 如果遇到延迟，请等待而不是重复点击
4. **禁用其他拍卖行插件**: 避免多个插件同时调用API

## 保留的功能

以下核心功能仍然可用：
- 单次物品搜索
- 手动逐个上架物品
- 查看当前价格
- 价格历史记录（基于已缓存数据）
- 购物列表（需手动触发搜索）
- 快捷键操作
- Tooltip价格显示

## 已移除/限制的功能

- ❌ 全拍卖行扫描（Full Scan/Replicate）
- ⚠️ 自动批量搜索（需手动触发）
- ⚠️ 快速连续操作（增加了延迟）

## 技术说明

这些修改主要通过以下方式工作：
1. 直接禁用最消耗资源的全扫描功能
2. 在关键的查询点增加延迟（throttling）
3. 减少单次请求的数据量
4. 禁用自动触发的查询

所有修改都保留了原始代码（注释掉），方便以后根据情况调整或恢复。

## 版本信息
优化版本基于: Auctionator v284 for Interface 30405 (WotLK Classic)
优化日期: 2024
